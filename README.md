# RentCar

Simple car rent management app (WIP, not ready yet)

## Models (System Entities)

### Country 

Страна, где работает сервис

* countryId: id
* name: название страны

## City

Город, где работает сервис

* cityId: id
* countryId -> Country
* name: название города

## Party

Контрагенты (юридические и физические лица)

* partyId: id
* legalType: тип контрагента ООО, ИП, Физ лицо
* fullName: полное наименование организации для использования в доукментах
* shortName: сокращенное наименование организации
* akaName: управленческое наименование, товарный знак и тп 
* legalCodes: [ LegalCode ] : ИНН, ОГРН, лицензии и другие коды
* bankAccounts: [ BankAccount ] : банковские счета 
* addresses: [ PartyAddress ] : массив адресов контрагента (юридический, главный офис, филиалы и тп)
* management
* linkedParties: [ LinkedParty ]
* comments: примечания

## Address 

Таблица хранения адресов

* addressId
* countryId: > Country
* countryRegion: регион страны (область, штат и тп)
* cityId: -> City
* district:
* street:
* building:
* office
* comments:

## PartyAddress

Таблица для хранения различных адресов, связанных с организацией

* partyAddressId: id
* partyId: -> Party
* addressId: -> Address
* addressType: AddressType* : тип адреса: юридический, главный офис, подразделение
* description: описание этого адреса (например, "Офис в Центральном районе")

## LinkedParty

Связанные организации

* linkedPartyId: id
* partyId: -> Party: контрагент
* linkedId: -> Party: ссылка на связанного контрагента
* linkType: PartyLinkType*: вид связи
* description: текстовое описание связи

## Bank

Банк

* bankId: id
* partyId: -> Party: контрагент со сведениями о банке
* codes: BankCodes: коды банка (БИК, к/счёт и тп)

## BankAccount

* bankAccountId: id
* bankId: -> Bank: ссылка на банк в базе контрагентов
* partyId: -> Party: ссылка на контрагента, к которому относится банковский счёт
* accountCurrency: валюта счетёта (RUR, USD, EUR, etc)
* accountType: AccountType*: описасние счёта (расчетный, депозитный, транзитный, корр счёт и тп)
* accountNo: номер счёта
 
## LegalCode

* legalCodeId: id
* partyId: -> Party: ссылка на контрагента, к которому относится этот код
* legalCodeType: тип кода - ИНН, ОГРН, Лицензия определенного вида (перечисление LegalCodeTypes)
* legalCodeValue: значение кода

## Contact (* not yet)

Контактная ифнормация

* contactId: id
* contactType: ContactType*: тип контактной информации (email, tel, messenger, etc)
* caption: этикетка для контактной информации
* contact: контактная информация (значение поля)
* comments: примечания

## PartyContact (*)

Таблица для связки контрагентов и контактной информации

* partyContactId: id
* partyId: -> Party
* contactId: -> Contact

## Company

Компании
 
* companyId: id
* partyId: -> Party: ссылка на сведения о контрагенте для этой прокатной компании
* companyType: тип компании
* bankAccountId: -> BankAccount: основной банковский счёт, который использует компания по-умолчанию в документах

## Group

Группы (разного назначения)

* groupId: id
* groupType: тип группы
* caption: название группы

## PartyGroup

Связка Групп и Контрагентов

* partyGroupId: id
* groupId: -> Group: 
* partyId: -> Party

## Customer

Клиенты сервиса

* customerId: id
* partyId: -> Party: ссылка на сведения о контрагенте

TODO: доработать схему активации профиля клиента

## Product

Продукты - товары или услуги, предоставляемые компанией

* productId: id
* companyId -> Company
* productType: ProductType* : тип продукта - товар или услуга
* caption: название продукта
* description: описание

## Car

Автомобили, зарегистрированные в системе

* carId: id
* carBaseCarId -> CarBase_Car: ссылка на сведения о модели автомобиля в общей базе моделей
* ownerId -> Company
* rentService: -> Service: ссылка на тип услуги, описывающей арендную стоимость автомобиля
* carYear: год выпуска данного автомобиля 
* color: цвет автомобиля

## CarFeature

Опции данного автомобиля (отличия от базовой комплектации, зарегистрированной для CarBaseCar)

* carFeatureId: id
* carId -> Car: машина, к кторой относится опция
* featureType: FeatureType*: тип опции
* featureValue: значение опции
* featureURL: дополнительное описание опции

## Currency (*)

Валюта

* currencyId: id
* name: название валюты
* shortName: сокращенное наименование валюты
* symbol: однобуквенный символ валюты

## CurrencyRate (*)

Курсы валют

* currencyRateId: id
* currencyId: -> Currency: валюта, для которой определяем курс (например, EUR)
* rateCurrencyId: -> Currency: валюта, в которой выражен курс (например, RUR)
* date: дата курса
* rate: значение курса
* source: источник данных о курсе

## Price <--

Цена услуги

* priceId: id
* productId: -> Product: продукт, к которому относится эта цена
* startDateType: тип стартовой даты - единоразово или регулярно
* startDateValue: значение стартовой даты
* endDateType: тип финишной даты
* endDateValue: знаение финишной даты
* price
* currencyId
* description: описание
* activeDiscounts: какие скидки действуют от этой цены
* inactiveDiscounts: какие скидки НЕ действуют для этой цены

Примечания:

Идея в модели цены - возможность делать расписание для цен, типа, последнее воскресенье месяца - скидки! 
Удобно для сезонных цен - замой цена низкая, летом вырастает. 

## CarBooking

Сведения о бронировании автомобилей

* carBookingId: id
* carId: -> Car: выбранный для бронирования автомобиль
* priceId: -> Price: цена, по которой бронировался автомобиль
* customerId: -> Customer: клиент, забронировавший автомобиль
* date: дата, когда было сделано бронирование
* pickDate: дата, с которой нужно бронировать авто
* pickTime: время с которого забирают авто
* pickLocation: -> Location: место, где забирают авто
* pickAddress: текстовое описание места 
* dropDate:
* dropTime:
* dropLocation:
* dropAddress:
* invoiceId: заказ с перечнем товаров/услуг
* billId: счёт за услуги

Бронирование может быть связано с пакетом услуг.

## Invoice

Счет (инвойс) на товары / услуги

* invoiceId: id
* partyId: -> Party: кто выставил счёт
* customerId: -> Party: кому выставили счёт
* totalAmount: сумма счёта
* paymentTerms: график оплаты
* description: примечания

Примечания: при развитии системы можно добавлять "purchase order no" (номер заказа клиента), "credit terms" (условия по кредиту) и тп. 

## InvoiceDetails

Детали инвойса, составляющие перечень товаров и услуг в счёте

* billDetailId: id
* billId: -> Bill: счёт, ко ромку относитсяп запись
* priceId: -> Price: цена, по которой выставляется счёт

____


# CarBase: база данных моделей автомобилей

(большой справочник актуальных моделей автомобилей, их моделей, модификаций, цен, характеристик, фотографий) 

## BaseCar

Модель машины

* baseCarId: id
* makerName: 
* modelName:
* modification: 
* complectation:
* modelYear:

----

## Endpoints

> GET /countries

Возвращается список стран, где работает эта система бронирования

> GET /countries/:countryId/cities

Возвращается список городов в указанной стране, где работает система

> GET /cities

Возвращается полный список городов, где работает система

> GET /cities/:cityId

Возвращается полная информация по городу, в котором работает система

>GET /countries/:countryId/cities/:cityId/locations
> GET /cities/:cityId/locations

Возвращается список стандартных локаций, где можно забрать/оставить автомобиль
возможность доставки в нестандартную локацию - доп услуга прокатной компании, должна быть в перечне услуг для данного города.

> GET /countries/:countryId/cities/:cityId/companies
> GET /cities/:cityId/companies

Возвращается список прокатных компаний, которые работают в данном городе

> GET /companies

Возвращается полный список прокатных компаний, зарегистрированных в системе

> GET /countries/:countryId/cities/:cityId/companies/:companyId
> GET /cities/:cityId/companies/:companyId
> GET /companies/:companyId

Возвращается информация о компании, зарегистрированной в системе

> GET /companies/:companyId/cities

Возвращается сипсок городов, где работает компания

> GET /companies/:companyId/services

Доп услуги, оказываемые компанией: доставка до адреса (список районов-исключений), кресла, доп оборудование и тп;

> GET /me

Профиль пользователя в системе

> GET /me/bookings 

Бронирования пользователя в системе

> GET /bookings

Получить доступные текущему авторизованному пользователю бронирования в системе

> GET /companies/:companyId/cars

Получить список имеющихся машин от этой компании в системе

### Управление гаражом (список машин)
 
> GET /cars

Получить список доступных машин

> GET /cars/:carId

получить сведения о конкретной машине

> POST /cars

Создать запись о машине

> DELETE /cars/:carId

Удалить сведения о машине

> POST /bookings

Создать новое бронирование для текущего пользователя


----

# User Stories

## Регистрация пользователя

Пользователь создает аккаунт на сервисе через форму регистрации, вносит необходимые данные в поля форм, прикрепляет фото документов и отправляет анкету на проверку.

Система проверяет анкету, и отправляет пользователю уведомление о готовности его аккаунта к работе.

## Поиск бронирования

Пользователь заходит на сайт системы и вводит данные в форму поиска: где нужен автомобиль, с какой даты и по какую.

Система выдает список автомобилей, доступных на выбранную дату.

Пользователь использует фильтры для настройки списка: выбирает класс автомобиля, тип трансмиссии и другие опции.

После выбора автомобиля система предлагает пользователю забронировать его, укомплектовав дополнительными опциями: детское кресло, доп водитель, и тп.

Пользовтаель выбирает место передачи, 

## Dev

Обработка запроса на бронирование:

* фильтруем записи о машинах: получаем перечень машин, потенциально доступных для бронирования в заданном регионе;

* для каждой машины получаем записи о бронировании в указанный временной период - дата бронирования от начальной даты, или дата окончания меньша начальной даты: смотрим количество таких записей. Если записей нет - то машина доступна.


## Future ideas

Управление техническим обслуживанием автомобилей
